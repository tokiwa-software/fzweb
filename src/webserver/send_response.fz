# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature send_response
#
# -----------------------------------------------------------------------

# like its three-argument counterpart, but sends a blank response
#
module send_ok_or_reload (s Session) response =>
  send_ok_or_reload s ""


# send an HTTP 200 response with the given data if there is a session,
# and data can be send back over the session, otherwise, return a 500
# response and ask the client to reload
#
module send_ok_or_reload (s Session, datastr String) response =>
  returncode := if !s.is_connection_ok then 500 else 200
  must_message := "must reconnect"
  data := if returncode = 500 then must_message.utf8 else datastr.utf8
  data2 := data.as_array
  header := (lock_free.Map String String).from_entries [("Content-Length", data2.length.as_string), ("Content-Type", "text/html")]
  response.new returncode header data2


# send an HTTP 200 response along with the given data
#
module send_ok (datastr String) response =>
  data := datastr.utf8.as_array
  header := (lock_free.Map String String).from_entries [("Content-Length", data.length.as_string), ("Content-Type", "text/html")]
  response.new 200 header data


# send an HTTP response indicating that the content requested has not
# been sent due to a missing implementation in this webserver
#
module send_nyi response =>
  response.new 500
