# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature hash_password
#
# -----------------------------------------------------------------------

# hash given password using bcrypt
#
module hash_password(password String) =>
  res, d := time.stopwatch String ()->
    password_bytes := password.utf8.map (.cast_to_i8)

    String.from_bytes
      <| (.map (.cast_to_u8))
      <| Java.at.favre.lib.crypto.bcrypt.BCrypt.withDefaults.hash cost password_bytes

  logger.log "Hash using cost {cost} took {d}."
  logger.log "password.hash: {res}"
  c := Java.at.favre.lib.crypto.bcrypt.BCrypt_static.verifyer.verify__u00005b_B_u00005b_B
    (password.utf8.map (.cast_to_i8)) (res.utf8.map (.cast_to_i8)) .verified
  logger.log "Checking... {c}"

  res


# cost of verification parameter given to bcrypt library
#
cost => 12
