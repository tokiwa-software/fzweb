# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature email_service
#
# -----------------------------------------------------------------------


# email_service -- features to send mail
#
module email_service is

  # read secrets from config file
  #
  secrets := config_file.open (path.of "./smtp_config.txt")


  # authentication details
  #
  username := secrets["username"] .get
  password := secrets["password"] .get
  host     := secrets["host"]     .get

  # send an email containing a text body
  #
  # from is the email address used as the sender
  # to is the recipient of the email
  # subject is the subject of the message
  # body is the body of the message, as a string
  #
  # the email automatically gets sent as a blind carbon copy to
  # an internal mailbox
  #
  module send_text_mail (from, to, subject, body String) =>
    mail.send host username password from to subject body


  # send an email containing a text body
  # with the company information added as a footer
  #
  module send_text_mail_with_footer (from, to, subject, body) =>

    io.file.read (content.templates_dir.resolve "email_footer.txt")
      .bind (footer -> send_text_mail from to subject (body + footer))
