# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature read_file_as_string
#
# -----------------------------------------------------------------------


# read file p file and return
# its contents as a String
#
module read_file_as_string(c choice String path) outcome String =>
  (read_file c).bind b->
    String.from b


# read file p file and return
# its contents as an array of bytes
#
module read_file(c choice String path) outcome (array u8) =>
  str := match c
    s String => s
    p path => p.as_string
  # NYI: UNDER DEVELOPMENT cache these reads?
  io.file.use str io.file.mode.append ()->
    sz := (io.file.stat str false).val.size
    io.file.open.mmap 0 sz ()->
      array u8 sz.as_i32 i->
        io.file.mapped_buffer.env[i.as_i64]
