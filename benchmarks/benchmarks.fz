# -----------------------------------------------------------------------
#
#  Tokiwa Software GmbH, Germany
#
#  Source code of Fuzion webserver feature benchmarks
#
#  for running benchmarks of webserver code
#
#  NOTE: that this is not part of a running webserver
#
# -----------------------------------------------------------------------


benchmarks =>

  duration := time.duration.s 10
  warmup := time.duration.s 2

  b(f ()->unit) =>
    bench warmup duration f


  session_document_get_content(where String) =>
    x := io.Out.instate _ io.Out.blackhole ()->
      s := Session (net.ip_address u128.zero) nil
      sd := session_document where s
      _ := sd.get_content
      b ()->
        _ := sd.get_content

    say "session_document.get_content {where} iter/s: {x}"


  session_event_msg(where String) =>
    x := io.Out.instate _ io.Out.blackhole ()->
      s := Session (net.ip_address u128.zero) nil
      s.set_current where

      b ()->
        _ := s.event_msg

    say "Session.event_msg {where} iter/s: {x}"

  g := io.Out.instate _ io.Out.blackhole ()->
    global

  g ! ()->
    session_document_get_content "docs/base/index"
    session_document_get_content "tutorial/"
    session_document_get_content "news/"
    session_document_get_content "index"
    session_event_msg "docs/base/index"
    session_event_msg "tutorial/index"
    session_event_msg "news/index"
    session_event_msg "index"
